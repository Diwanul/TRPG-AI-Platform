# TRPG AI 平台 - 整体方案规划

## 一、项目概述

### IDE 概念
- **AI 和外部资源 = 编辑器和编译器**
- **这个平台 = IDE（集成开发环境）**

一个轻量级、免费、开源的 TRPG 游戏 IDE。核心职能：

1. **外置记忆系统**
   - 完整游戏历史、角色档案、关键事件、决策树
   - 可搜索、可分析、可导出
   - AI DM 的"长期记忆库"

2. **资源集成平台**
   - 聚合各种 TRPG 资源（规则、模组、工具）
   - 为 AI 和玩家提供统一的工作环境
   - 实时链接外部资源（5e 补全书等）

3. **AI 的工作台**
   - 为 AI 提供完整的上下文（历史、角色、资源）
   - 通过界面和结构化数据引导 AI 决策
   - 记录 AI 的推理过程

4. **玩家的游戏创意空间**
   - 记录想法、规划冒险、体验反思
   - 不只是游戏过程，还是游戏创意的载体

---

## 二、技术方案

### 2.1 技术栈选择

| 组件 | 方案 | 原因 |
|------|------|------|
| **前端框架** | Vue 3 + Vite | 轻量级，快速开发，完全够用 |
| **UI 组件库** | 轻量 CSS（Tailwind 或自定义） | 最小化依赖，专注于游戏体验 |
| **后端服务** | 无 | 如需服务器，使用免费函数即可 |
| **AI 接口** | OpenAI / Claude（用户自提供 API Key） | 核心是 Prompt Engineering，API 本身轻松处理 |
| **数据存储** | 本地 IndexedDB + 可选导出 | 简单轻量，用户会话保存在浏览器 |
| **代码托管** | GitHub | 内置 GitHub Pages 部署 |

### 2.2 架构设计

```
TRPG-AI-Platform (IDE)
├── src/                        # Vue 3 + Vite 前端项目
│   ├── components/
│   │   ├── GameBoard.vue      # 游戏主界面（"编辑器"区域）
│   │   ├── CharacterSheet.vue # 角色档案管理（记忆系统）
│   │   ├── ChatWindow.vue     # AI 对话窗口（AI 工作台）
│   │   ├── SessionHistory.vue # 会话历史查询（外置记忆）
│   │   ├── ResourcePanel.vue  # 资源集成面板
│   │   └── ...
│   ├── views/
│   │   ├── GameStudio.vue     # 游戏工作室（主 IDE 界面）
│   │   ├── ResourceHub.vue    # 资源中心
│   │   ├── Memories.vue       # 记忆库（可搜索）
│   │   └── Settings.vue       # 设置
│   ├── stores/                # Pinia 状态管理
│   │   ├── game.ts            # 游戏状态
│   │   ├── memory.ts          # 记忆系统（重点）
│   │   └── resources.ts       # 资源索引
│   ├── utils/
│   │   ├── aiService.ts       # AI API 调用
│   │   ├── memoryEngine.ts    # 记忆引擎（搜索、分析、检索）
│   │   ├── resourceParser.ts  # 资源解析器
│   │   └── storage.ts         # IndexedDB 操作
│   └── prompts/
│       ├── dm-system.ts       # DM 系统提示词
│       └── memory-context.ts  # 记忆上下文构建
│
├── public/
│   └── external-resources.json # 外部资源链接索引
│
├── docs/
│   ├── ARCHITECTURE.md        # IDE 架构说明
│   ├── MEMORY-SYSTEM.md       # 记忆系统文档
│   ├── PROMPTS.md             # Prompt Engineering 指南
│   └── DEV.md                 # 开发指南
│
├── .github/workflows/          # CI/CD
├── vite.config.ts
├── package.json
└── README.md
```

---

## 三、核心功能模块

### 3.1 游戏循环系统

**初期模式（简单直接）：**
- **用户 = PL，AI = DM**
- 支持任意规则系统（通过 Prompt 说明）
- 最大化 AI 自由度：开卡、难度调整、故事推进、骰子检定都由 AI 智能处理

**核心流程：**
```
1. 设置会话（选择规则系统 / 背景设定 / 难度倾向）
2. AI 引导角色创建（通过对话而非表单）
3. 游戏开始
4. 玩家输入行动 → AI DM 响应（含故事、检定、结果）
5. **系统自动记录到记忆库**（包含完整上下文）
```

**后期可选功能：**
- 多人游戏
- 用户当 DM

### 3.2 前端主要页面（IDE 布局）

| 区域 | 功能 | 说明 |
|------|------|------|
| **游戏工作室** | 游戏界面 + 角色卡 + AI 对话 | IDE 的编辑器区，玩家的游戏创意空间 |
| **记忆库** | 可搜索的历史、角色档案、决策树 | 外置记忆系统，AI 的长期记忆库 |
| **资源中心** | 规则、模组、工具的聚合 | 为 AI 和玩家提供统一的工作环境 |
| **设置** | API Key、难度、记忆策略等 | IDE 的配置面板 |

### 3.3 记忆系统（核心创新）

**记忆不只是存储，还是：**

1. **结构化记忆**
   - 角色档案：属性、装备、经历
   - 故事线：主要事件、分支、结果
   - 关键决策：玩家的重要选择点
   - AI 推理：DM 的故事逻辑和难度调整

2. **可查询的记忆**
   - 全文搜索：快速找到相关历史
   - 时间线视图：直观看游戏进度
   - 关系图：NPC、地点、事件的关联
   - 统计分析：游戏数据（战斗胜率、选择倾向等）

3. **AI 能访问的记忆**
   - 完整游戏历史作为上下文（AI 永不遗忘）
   - 结构化记忆帮助 AI 做出连贯决策
   - 记忆摘要自动生成（Token 优化）

### 3.4 资源集成（IDE 的"库"）

**资源不只是链接，还是：**

1. **资源索引**
   - 本地资源索引（规则关键词、模组名单）
   - 外部资源链接（5e 补全书、COC 规则等）
   - AI 能快速引用的资源摘要

2. **资源联动**
   - 游戏中提到的概念自动链接到资源
   - AI 能在对话中主动建议相关资源
   - 玩家能在游戏中快速查询规则

3. **社区资源贡献**
   - 用户上传自己的模组
   - 社区分享优化的 Prompt
   - 用户发布自己的冒险记录

---

## 四、免费资源方案

### 4.1 部署方案

| 服务 | 免费额度 | 用途 |
|------|---------|------|
| **GitHub Pages** | 无限制 | 托管前端（Vue 构建产物） |
| **GitHub Actions** | 免费 | 自动部署 CI/CD |

**就这两个。** 完全不需要后端服务器或 Vercel。

### 4.2 AI API 方案

| API | 推荐 | 说明 |
|-----|------|------|
| **OpenAI (GPT-4/3.5)** | ⭐⭐⭐ | 最稳定，用户自提供 API Key |
| **Claude (Anthropic)** | ⭐⭐⭐ | 长上下文，自提供 API Key |
| **Google Gemini** | ⭐⭐ | 可用，但暂时不推荐 |

**实装方式：**
- 用户在设置页面输入自己的 OpenAI / Claude API Key
- 所有 API 调用在前端执行（通过代理避免 CORS）
- 初期甚至可以不需要后端，直接在浏览器调用

### 4.3 数据存储方案

**浏览器本地存储（IndexedDB）**
- 会话数据保存在用户浏览器
- 支持导出为 Markdown / JSON
- 完全免费，无服务器成本
- 用户可手动备份

---

## 五、开发阶段规划

### Phase 1: MVP（最小可行产品）- 1-2 周
**目标：** 一个能玩且能记忆的基础版本

- [ ] 项目初始化（Vue 3 + Vite）
- [ ] 游戏工作室 UI：游戏界面、角色卡、AI 对话
- [ ] AI 集成：OpenAI API 调用（用户 Key）
- [ ] **记忆引擎**：将游戏会话结构化保存
- [ ] 基础记忆库：简单搜索和浏览
- [ ] 会话管理：IndexedDB 保存和加载
- [ ] GitHub Pages 部署
- [ ] 基础 Prompt（DM 系统提示词）

**交付物：** 完整可玩 + 有记忆的原型

### Phase 2: 记忆系统优化 - 1-2 周
- [ ] **记忆提取优化**：自动从对话中提取关键信息
- [ ] **可搜索的记忆库**：全文搜索、标签、分类
- [ ] **记忆驱动的 AI**：AI 能更好地引用历史
- [ ] **资源索引系统**：建立规则、NPC、地点的索引
- [ ] **可视化时间线**：游戏进度的时间线视图

### Phase 3: 资源集成 - 后续
- [ ] 资源聚合面板（规则、模组链接）
- [ ] 资源与游戏的联动
- [ ] 社区资源贡献系统
- [ ] UI 优化和多人游戏支持

---

## 六、GitHub 开源策略

### 6.1 仓库结构

```
README.md (含使用说明、贡献指南、许可证)
LICENSE (MIT/Apache 2.0)
CONTRIBUTING.md
docs/ (完整文档、API 文档)
```

### 6.2 开源协议
- **推荐：** MIT 或 Apache 2.0
- 鼓励社区贡献规则库和 AI Prompt

---

## 七、关键技术决策

| 决策 | 选择 | 理由 |
|------|------|------|
| **前端框架** | Vue 3 + Vite | 轻量、快速开发 |
| **样式方案** | 自定义 CSS（或轻量 Tailwind） | 最小化依赖，专注于游戏体验 |
| **AI 集成** | 用户自提供 API Key | 零成本，用户控制 |
| **数据存储** | IndexedDB + 导出 | 完全本地，无服务器成本 |
| **部署** | GitHub Pages + Actions | 零成本自动化 |
| **设计哲学** | AI-driven，最小 hardcode | Prompt 承担逻辑，代码保持简洁 |

---

## 八、成本分析

| 项目 | 成本 | 说明 |
|------|------|------|
| **开发和托管** | **$0** | GitHub + GitHub Pages 免费 |
| **AI API** | **用户自付** | 用户自己的 OpenAI / Claude 账户 |
| **域名** | $0 | `username.github.io` 或自定义 |
| **总计** | **$0**（平台） | 完全免费和开源 |

---

## 九、特色理念

### IDE 的核心价值

1. **外置记忆 = 游戏的"持久化"和"可分析性"**
   - 不仅是保存游戏进度，而是记录完整的游戏创意过程
   - AI 永不遗忘，能做出连贯的故事决策
   - 玩家能反思自己的游戏选择

2. **资源集成 = 游戏的"生态系统"**
   - 不只是链接外部资源，而是建立资源和游戏的联动
   - AI 能智能引用资源，玩家能快速查询
   - 社区资源贡献成为平台的增长引擎

3. **Prompt Engineering = 游戏的"灵魂"**
   - DM Prompt 决定游戏的风格和难度
   - 代码最小化，Prompt 驱动所有逻辑
   - 社区能轻松改进和创新

4. **零 hardcode = 极致的扩展性**
   - 新规则系统只需新 Prompt
   - 新游戏模式通过资源集成实现
   - 代码保持精简可维护

---

## 十、第一步行动清单

1. **创建 GitHub 仓库** → `TRPG-AI-Platform`
2. **初始化项目** → `npm create vite@latest -- --template vue`
3. **编写 DM Prompt** → 系统提示词、示例对话
4. **实现核心游戏循环** → ChatWindow 组件 + AI API 调用
5. **实现角色卡** → Markdown 编辑器
6. **会话管理** → IndexedDB 存储
7. **部署** → GitHub Actions + Pages

---

## 总结

**这个 IDE 的核心价值：**
- ✅ **不只是游戏界面，而是完整的游戏创意空间**
- ✅ **外置记忆系统让 AI 永不遗忘，故事更连贯**
- ✅ **资源集成让玩家和 AI 有统一的工作环境**
- ✅ **代码极其轻量，Prompt 驱动一切**
- ✅ **开源生态围绕 Prompt 和资源，而非代码**

**下一步：** 根据 IDE 概念，确认方案后开始 Phase 1 开发。重点是设计好：
1. **记忆引擎**的数据结构（最关键）
2. **Prompt 如何利用记忆上下文**
3. **资源索引的初始设计**
